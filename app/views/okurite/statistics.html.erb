<h1 class="page-title">送信成功率ダッシュボード</h1>

<div class="metrics-container">
  <div class="metric-card">
    <div class="metric-label">総試行回数</div>
    <div class="metric-value"><%= @total_attempts %></div>
  </div>
  
  <div class="metric-card">
    <div class="metric-label">成功回数</div>
    <div class="metric-value"><%= @successful_submissions %></div>
  </div>
  
  <div class="metric-card">
    <div class="metric-label">成功率</div>
    <div class="metric-value" style="color: <%= @success_rate >= 60 ? '#28a745' : '#dc3545' %>">
      <%= @success_rate %>% <%= @success_rate >= 60 ? '✅' : '⚠️' %>
    </div>
  </div>
  
  <div class="metric-card">
    <div class="metric-label">処理中</div>
    <div class="metric-value"><%= @pending_submissions %></div>
  </div>
</div>

<% if @failure_breakdown.any? %>
<div class="failure-section">
  <h2 class="section-title">失敗原因分析</h2>
  <div class="failure-chart">
    <% total_failures = @failed_submissions %>
    <% @failure_breakdown.each do |status, count| %>
      <% percentage = total_failures > 0 ? (count.to_f / total_failures * 100).round(1) : 0 %>
      <div class="failure-item">
        <div class="failure-type"><%= status %></div>
        <div class="failure-bar-container">
          <div class="failure-bar" style="width: <%= percentage %>%;"></div>
        </div>
        <div class="failure-count"><%= count %>件 (<%= percentage %>%)</div>
      </div>
    <% end %>
  </div>
</div>
<% end %>

<div class="action-buttons">
  <%= link_to "戻る", sender_okurite_index_path(@sender), class: "btn btn-secondary" %>
  <% if @success_rate < 60 %>
    <%= link_to "改善アクション", "#improvement-actions", class: "btn btn-warning" %>
  <% end %>
</div>

<style>
.metrics-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.metric-card {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.metric-label {
  font-size: 14px;
  color: #6c757d;
  margin-bottom: 8px;
}
.metric-value {
  font-size: 28px;
  font-weight: bold;
  color: #212529;
}
.failure-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-top: 30px;
}
.failure-item {
  margin-bottom: 15px;
}
.failure-type {
  font-weight: bold;
  margin-bottom: 5px;
}
.failure-bar-container {
  height: 20px;
  background: #e9ecef;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 5px;
}
.failure-bar {
  height: 100%;
  background: #dc3545;
}
.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}
</style>
